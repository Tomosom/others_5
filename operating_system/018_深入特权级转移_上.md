深入特权级转移

■ 初 识 任 务 状 态 段 （Task State Segment)
    -处理器所提供的硬件数据结构，用于实现多^解决方案
    - T S S 中保存了关键寄存器的值以及不同特权级使用的栈
                                       段寄存器
                                      通用寄存器

                                不同特权级的栈信息

狄泰一+未来 © 2018成都狄泰未来科技有限公司 唐佐林视^频教程

 深入特权级转移

■ TSS中不同特权级的栈信息                                     104 Bytes
    -在TSS中只保存了 3个栈的信息
         • 特 权 级 〇 : ssO, espO
         • 特 权 级 1 : ssl, espl
         • 特 权 级 2 : ss2 , esp2

狄泰一+未来                                                         低
        © 2018成都狄泰未来科技有限公司 唐佐林视^频教

深入特权级转移

■特权级转移时的栈变化
    一低特权级+高特权级（调用门）
          ♦ 从TSS获取高特权级目标搬
          ♦ 将低特权级枝信息压入高特权级枝中（s s 和e s p )
    -高特权级+低特权级（retf)
          ♦ 将低特权级枝信息从高特权级枝中取出并恢复到SS和esp

狄泰一+未来  © 2018成都狄泰未来科技有限公司 唐佐林视^频教

深入特权级转移

■有趣的问题
                       TSS中为什么只保存3个特权级
                              (0, 1, 2 ) 的 栈 信 息 ？

狄泰一+未来  © 2018成都狄泰未来科技有限公司                          唐佐林视^频教程

深入特权级转移

■目标实验（操作系统雏形）
    -赌权级高特权级
         1*定义32位核心代码段和数据段（Privilege = 0 )
         2*定义32位任务代码段和数据段（Privilege = 3 )
         3 * 由核心代码段© _ 到任务代码段执行（高今低）
         4在任务代码段中调用高特权级代码段打印字符串（Call Gate )

狄泰一+未来  © 2018成都狄泰未来科技有限公司 唐佐林视^频教

深入特权级转移

■目标实验（操作系统雏形）

狄泰一+未来  © 2018成都狄泰未来科技有限公司                          唐佐林视^频教程

深入特权级转移

■注意事项
    -特权级转移时会发生栈的变换（如何变换？）
    -栈的变化需要在TSS结构体中预先定义
    _ TSS结构体作为呼独立段定义（描述符，选择子）
    -在核心代码段中加载具体的TSS结构体（ItrTSSSelector)

---------------------------------我是可爱的页面分割线-------------------------------------
狄泰一+未来         © 2018成者|5狄泰未来科技有限公司        唐佐林+ 见频教程

The shortest answer is doing.

                编程实验

               特权级转移综合实验

狄泰一+未来         © 2018成都狄泰未来科技有限公司          唐佐林视^频教程

深入特权级转移

■问题

               RPL究竟是什么？有什么用？

狄泰一+未来         © 2018成都狄泰未来科技有限公司          唐佐林视^频教程

深入特权级转移

■ RPL的意义

-位置意义
     •选择子或段寄存器的最低2位

-请求意义
     •资源请求的特权级（不同于当前特权级CPL )

                  15--3  21—0
               描述符索引值
                         T I RPL

狄泰一+未来         © 2018成都狄泰未来科技有限公司          唐佐林视^频教程

深入特权级转移

■ RPL的意义

                   当需要请求获取某种资源时，处理器通过
                 CPL, RPL和DPL共同确定请求是否合法！

          CPL  RPL                    DPL

狄泰一+未来         © 2018成都狄泰未来科技有限公司          唐佐林视^频教程

深入特权级转移

■ To be continued ...
                   处理器通过什么规则判断资源请求或
                               代码繼是否合法？

狄泰一+未来         ◎ 2018成都狄泰未来科技有限公司          唐佐林视频教程

 小结

■ TSS是通过调用门转移到高特权级执行的关键
   TSS是处理器的硬件数据结构，用于实现多任务
   TSS结构体遵循保护模式下内存使用的规则
   RPL在请求资源时是合法性判断的依据之_

■ 处理器使用CPL, RPL和DPL共同确定合法性

狄泰一+未来         ◎ 2018成都狄泰未来科技有限公司          唐佐林视频教程

  狄泰未来

在这里收获的是未来，而不只是技术!
              交流群：199546072

                  ◎ 2018成都狄泰未来科技有限公司

---------------------------------我是可爱的页面分割线-------------------------------------
