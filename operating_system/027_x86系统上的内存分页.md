x86系统上的内存分页

-  x86系列处理器上的页式内存管理
     -硬件层直接支持内存分页机制
     -默认情况下不使用分页机制（段式内存管理）
     -分页机制启动后，使用二级页表对内存进行管理

                                                                                             離林臟教程

x86系统上的内存分页

-  x86系列处理器的分页方式（32位）

      局                                                                                   低

      10 b i t s 10 b i t s                                       12 b i t s
      iii i
                                                                                i
                       1

                           用于在页目录中  用于在子页表中                           页内偏移地址
                           查找子页表祖   查找回标页地址

狄泰未来                               © 2018成都狄泰未来科技有限公司唐佐林_教程

x86系统上的内存分页

-  x86分页机制示意图

                            页目录

                        局                                                                                    低
狄泰未来                               © 2018成都狄泰未来科技有限公司唐佐林_教程

x86系统上的内存分页

-  x86系列处理器的分页方式（32位）
    -页目录大小
         •210项，每项4字节，共计210*4 = 212 + 4K
    -子页表大小
         •210项，每项4字节，共计210*4 = 212 + 4K
    -页大小
         • 212 字节+ 4K

狄泰未来                               © 2018成都狄泰未来科技有限公司唐佐林_教程

x86系统上的内存分页

- —些重要结论（针对32位x86处理器）
    -页目录占用1内存页（可访问1024个子页表）
    -单个子页表占用1内存页（可访问1024个页面）
    -页面起始地址按4K字节对齐（总是4096整数倍）
    -分页后可访问的虚拟内存空间为：4K* (1024 * 1024) = 4G

狄泰未来                               © 2018成都狄泰未来科技有限公司唐佐林_教程

x86系统上的内存分页

- 最简单的分页构建方式

PageDirBase                  〇 PageTbIBase + 4096 * 0

                                   PageTbIBase + 4096 * 1

                                   PageTbIBase + 4096 *i

PageTbIBase                  1023  PageTbIBase +4096 *1023            0                   4096 *(1〇24 * k + 0 )
                                        4096 *(1〇24 *0 + 0)
                      子页表◦-   0

                                    4096 *(1〇24 *0 + 1)                                   4096 * (1〇24 * k + 1 )

                                                              子页表k -

                                   4096 *(1024 * 0 + } )                                       4096 *(1024 * k + j )

                             1023  4096 *(1〇24 *0 + 1023)             1023 4096 * (1〇24 *k+ 1023)
                                      4096 *(1〇24 *1 + 0)
                              0       4096 *(1〇2 4 * 1 + 1 )

      子页表1 -

                                   4096，（1024 • 1 + j}

                             1023 4096 *(1〇24 * 1 + 1023)

狄泰                                 © 2018成都狄泰未来科技有限公司                                        離林臟教程

x86系统上的内存分页

-  x86系列处理器上的页属性
    _由于物理页面的地址必彡萌^照4K字节对齐
    -因此，页目录（页表）可使用地址的低12位进行属性描述

      31                                                      11                          0
                          物理页面基址
                                                                  物理页面属性

       31...12                      1 1 ...               DDODDDBDO

    Page Address Base               Available                 G PS D A PCD PWT U/S R/W P

---------------------------------我是可爱的页面分割线-------------------------------------
狄泰         © 2018成都狄泰未来科技有限公司

x86系统上的内存分页

-  x86系列处理器上的页属性

      位    标记         说明
              P
        0   R/W       页面是否存在于内存中
        1   U/S       页面是否可读可写
        2   PWT       页面特权级说明
        3   PCD       页面缓冲策略
        4    A        页面是否可以被缓冲
        5   D/R       页面是否可访问
        6    PS       页面是否被写入硫
        7     G
        8             页面单felSE
     9…11  Avail
                      全局页面硫
                      预留给系统编程使用

狄泰         © 2018成都狄泰未来科技有限公司                                      離林臟教程

x86系统上的内存分页

-  x86对分页的硬件支持
    -将cr3指向页目录地址（可切换不同的页目录)
    -将crO最高位置1 (5更件级开启分页机制）

           mov    X PageDzrBase
           mov    3J
           mov    XJ  eax
           or
           mov    X J cr0

                  0 J 0x80000000

                  J eax

狄泰         © 2018成都狄泰未来科技有限公司                                      離林臟教程

x86系统上的内存分页

    汇编小贴士一
     -loop

                   循环指令，将cx减1 ,若cx不为0,则执行标签处代码

                                         mov ax^ 0
                                         mov cx, 10

                                                 Label:

                                                add ax, cx
                                                loop Label

狄泰         © 2018成都狄泰未来科技有限公司                                      離林臟教程

x86系统上的内存分页

    汇编小贴士.

        stosb / stosw / stosd

          •把al / ax / eax中的值存储到edi指向的内存单元中

          •同时edi的值根据方向标志增加或者减少（cld/std)

                                              mov es, ax
                                              mov edi, 0
                                              mov eax, 0xFF

                              cld

                                              stosd
                                              ; [ e s : 0] ^ 9xFF
                                              ;edi ^ 4

狄泰         © 2018成都狄泰未来科技有限公司                                      離林臟教程

The shortest answer is doing.

               编程实验

           x86处理器上的分页实现

狄泰         © 2018成都狄泰未来科技有限公司                                      離林臟教程

 小结

-  x86处理器直接支持内存分页机制（默认关闭）
-  分页机制启动后，使用二级页表对内存进行管理
-  页目录和单个子页表占用1内存页（4K内存）
-  页面起始地址按4K字节对齐
-  分页后可访问的虚拟内存空间为4G

狄泰         © 2018成都狄泰未来科技有限公司                                      離林臟教程

      狄泰未来

    在这里收获的是未来，而不只是技术

                交流群：199546072

                      © 2018成都狄泰未来科技有限公司

---------------------------------我是可爱的页面分割线-------------------------------------
