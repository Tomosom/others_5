# 深入特权级转移
- 问题
    处理器通过什么规则判断资源请求或代码跳转是否合法？

- 数据段的访问规则（数据段无可执行属性)
    - 访问者权限（CPL )高于或等于数据段特权级（DPL )
    - 请求特权级（RPL)高于或等于数据段特权级（DPL)
    - 即 : (CPL <= DPL) && (RPL <= DPL)

- 访问示例：
    - CPL = 2 , RPL = 1 , DPL = 3 , 访问是否合法 ？
    - CPL = 0 , RPL = 3 , DPL = 2 , 访问是否合法 ？
    - CPL = 0 , RPL = 1 , DPL = 2 , 访问是否合法 ？

# 编程实验 数据段的访问规则

- 实验结论
    - 选择子被段寄存器加载时，会进行保护模式的检查
        - 检查选择子的下标是否合法（段描述符的合法性）
        - 检查特权级是否合法（CPL& RPL <= DPL )
        - 检查特权级时CPL和RPL之间不会进行比较

- 代码段的分类
    ![](_v_images_/.png)

- 非系统段的分类
    - 一致注代码段：X = 1, C = 1
    - 非一致性代码段：X = 1, C = 0

    ![](_v_images_/.png)

-  代码段之间的跳转规则（不借助门描述符）
    - → 非一致性代码段
        - 代码段之间只能平级转移（CPL== DPL，RPL <= DPL)
    - → 一致性代码段
        - 支持低特权级代码向高特权级代码的转移（CPL>= DLP)
        - 虽然可以成功转移高特权级代码段，但是当前特权级不变

- 注意
    数据段只有一种，没有一致性和非一致性的区分; 并且，数据段不允许被低特权级的代码段访问°

# 编程实验 代码段的直接跳转规则

- 实验结论
    - 特权级降低转移时，retf 指令会触发栈段的特权级检查
    - 一致性代码段可直接跳转到其它同级非一致性代码段执行

- 小技巧
    大多数情况下，选择子中的RPL和对应段描述符中的DPL可设置为相同值！

# 小结
- CPL, RPL 和 DPL 是处理进行特权级保护的依据
- 对于数据段： CPL<=DPU, RPL<=DPL
- 对于非一致性代码段：CPL == DPL，RPL <= DPL
- 对于一致注代码段: CPL >= DPL, 转移后 CPL 不变
