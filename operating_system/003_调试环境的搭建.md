调试环境的搭建

■问题

                  如何调试主引导区的代码？

狄泰夺+未来  ◎ 2013成都狄泰未来科技有限公司                                    唐佐林视频教程

调试环境的搭建

■ Bochs (另一款优秀的虚拟机软件）

    - 专 业 模 拟 X86架构的虚拟机
    -开源且高度可移植，由C++编写完成

     一支持操彳乍系统开发过程中的断点调试
     _通过简单配置就能够运行绝大数主流的操作系统

狄泰夺+未来  ◎ 2013成都狄泰未来科技有限公司                                    唐佐林视频教程

调试环境的搭建

■ 支 持 调 试 功 能 的 Bochs版 本

     1* 下载源fi马：https://sourceforge.net/projects/bochs/files/
    2* 解压缩 bochs-2*x*x*tar*gz 今 bochs-2*x*x
     3*进入源码目录：cd bochs-2*x*x

      4 ./configure --enable-debugger --enable-disasm
      5* make
      6* sudo make install

狄泰一+未来  © 2018成都狄泰未来科技有限公司                                    唐佐林视频教程

The shortest answer is doing.

                    编程实验

                  Bochs的 安 装 与 配 置

狄泰一+未来  ◎ 2018成都狄泰未来科技有限公司                                    唐佐林视频教程

调试环境的搭建

■小贴士

    -确定bochs的安装路径（which bochs )
    -安装 vgabios ( apt-get install vgabios )
    -确定 vgabios 的安装路径（whereis vgabios )

狄泰夺+未来  ◎ 2013成都狄泰未来科技有限公司                                    唐佐林视频教程

调试环境的搭建

■ Bochs的启动文件

     #how much memory the emulated machine will have
     megs: 32

     # filename of ROM images
     romimage:file=/usr/local/share/boch$/BIOS-boch$-late$t
     vgaromimage:file=/usr/share/vgabio$/vgabio$.bin

     #what disk images will be used
     floppya: 1_44=a.img. $tatu$=in$erted

     # choose the boot disk,
     boot: floppy

     #where do we send log messages?
     #log: bochsout.txt

     # disable the mouse
     mouse: enabled=0

     # enable key mapping, using US layout as default.
     keyboard一 mapping: enabled=1, map=/usr/local/share/bochs/keymaps/x11-pc-us_map

调试环境的搭建

■ 启 动 bochs虚 拟 机

- 显 示 方 式 ：bochs -f bochsrc_file

- 隐 式 方 式 ：bochs

        ♦ .bochsrc '     -当前目录下的启动文件名
        ♦ bochsrc

        ♦ bochsrc.txt -

---------------------------------我是可爱的页面分割线-------------------------------------
狄泰一+未来                                 ◎ 2018成都狄泰未来科技有限公司                                          唐佐林视频教程

调试环境的搭建

  调试环境验证

〇 〇 Bochs x86 emulator, http://bochs.sourceforge.net/

P 1 ex86/Boclis UGAB ios current c^s 16 Apr Z010
b)is UGA/UBE Bios is released under tlie GNU L6PL

Iplease visit :                        〇 9 o delph吵 delphhvm: ~
  .http://bochs.sourceforge.net        文 件 (F>编 辑 (曰 董 鬌 (V)搜 索 (S)终 竦 (T)帮 助 (H)
  .http：//uuu.nongnu.org/vgab ios

feochs UBE Display Adapter enabled     000800906001[   ] reset of 'serial' plugin device by virtual utethod
 uc：Its BIOS - build： 04/05/10
 Hcvision： 1.247 $ $Date： 2010/04/04   eeeeeeeeeeeit   reset of 'parallel' plugin device by virtual method

Options: apmbios pcibios pnpbios elto  eeeeeeeeeeeifXGUi [x] Mouse off

          F12 for boot menu            00〇〇〇〇〇0〇〇0i[ set SIGIMT handler to bx_debug_ctrlc_handler
         ng from Floppy.               Next at t=e

 I'.llo, this is D.T.OS!               (6) rexfffffffei fflee：fffe (unkc.txt)： j»p far fee$：e〇5b                          ea5bee〇6fO
                                       <eb6ocehes：ele>e]c3o3nt«itnu>euSBRxev〇iSbionj： 1.247 $ $Date： 2616/64/04 19:33:56 $
                                       9OOOO318057i[KBD ] reset-disable comand received

                                       066064362271[VBIOS] VGABios $Id$

                                       966694362981[VGA ] V6E known Oisplay Interface becO

                                       00600436330i[VGA ] VBE known Display Interface b6c4

                                       oeeee436999i[vBios] V6E Bios $Id$

                                       eooooeeeeeeiixGui j charatap update. Font Height is 16

                                       90600754553i[BIOS 】 Starting ronbios32
                                       966697556561[BIOS ] Shutdown flag 0
                                       066097557311[8I0S ] rdm_size=exe266eee6

                                       000097562091[BIOS ] ran~end-32HB

                                       OOOO0796805i[BIOS ] Found 1 cpu(s)

                                       OOOO0816074i【BIOS 】 bios table addr： 0x606fbcl8 end-6x〇eefcc〇6
                                       OOO00828751i[BIOS ] bios_table_cur_addr： exeeefbcis
                                       6661294363Si[BI0S ] Booting fron 6006：7ce6

                                       0eei296ii37i[cpue ] WARNING: HLT instruction with IF=8!

The shortest answer is doing.

                                       编程实验

                                        Bochs的验证

狄泰一+未来                                 ◎ 2018成都狄泰未来科技有限公司                                          唐佐林视频教程

调试环境的搭建

■ Bochs中的常用调试命令

        命令                             功能                                          b 0x7c00
        b (break)                                                                  c
                                       设置断点                                        s
                                                                                   info b
        c (continue)                   继续撕                                         info epu
                                                                                   r
        s (step)                       单步执行                                        sreg
                                                                                   x/2bx 0x7c00
        info b (info break) 查看当前所有断点                                               trace on
                                                                                   trace-reg on
        info epu                       查看当前CPU状态

        r (reg)                        查看常规寄存器状态

        sreg                           查看段寄存器状态

        x/Nuf expression 查看内存中的数据

        trace onfoffj                  开关：打印执行的指令

        trace-reg onfoffj 开关：打印寄存器的值

狄泰一+未来                                 ◎ 2018成都狄泰未来科技有限公司                                          唐佐林视频教程

 小结

■ Bochs是一款专业模拟x86架构的虚拟机
■ 从 源 码 安 装 Bochs可以获得调试功能的支持
■ Bochs的启动配置文件是正确运行关键
■ Bochs支持断点调试，其调试命令与GDB类似

                                                                                    COWORKING
                                                                                           CENTER

狄泰一+未来                                 ◎ 2018成都狄泰未来科技有限公司                                          唐佐林视频教程

  狄泰未来

在这里收获的是未来，而不只是技术
              交流群：199546072

                  ◎ 2018成都狄泰未来科技有限公司

---------------------------------我是可爱的页面分割线-------------------------------------
