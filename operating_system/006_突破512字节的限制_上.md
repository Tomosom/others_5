# 突破 512 字节的限制

- 突破限制的预备工作
![](_v_images_/.png)

- 问题
    主引导程序中如何进行字符串打印？

- BIOS中的字符串打印
    - 指定打印参数 (AX = 0x1301, BX = 0x0007)
    - 指定字符串的内存地址 (ES:BP = 串地址)
    - 指定字符串的长度 (CX = 串长度)
    - 中断调用 (int 0x10)

- 字符串打印示例

```x86asm
mov ax, msg    ;指定字符串地址
mov bp, ax
mov ax, ds
mov es, ax

mov cx, 6    ;指定字符串长度

mov ax, 0x1301    ;指定打印参数
mov bx, 0x0007

int 0x10
```

- 汇编小贴士
    - 汇编中可以定义函数（函数名使用标签定义）
        - call function
        - 函数体的最后—条指令为 ret
    - 如果代码中定义了函数，那么需要定义栈空间
        - 用于保存关键寄存器的值
        - 栈顶地址通过 sp 寄存器保存
    - 汇编中的 "常量定义" (equ)
        - 用法：Const equ 0x7c00    ;#define Const 0x7c00
        - 与 dx (db, dw, dd)的区别：
            - dx定义占用相应的内存空间
            - equ定义不会占用任何内存空间

# 编程实验 定义打印函数 print

- 问题
    主引导程序中如何读取指定扇区处的数据？

- 软盘的构造
    - 一个软盘有2个盘面，每个盘面对应1个磁头
    - 每一个盘面被划分为若干个圆圏，成为柱面（磁道）
    - 每一个柱面被划分为若干个扇区，每个扇区512字节

    ![](_v_images_/.png)

- 3.5寸软盘的数据特性
    - 每个盘面一共80个拄面 (编号为0 - 79)
    - 每个拄面有18个扇区 (编号为1 - 18)
    - 存储大小：
          2 * 80 * 18 * 512 = 1474560 Bytes = 1440 KB

- 软盘数据的读取
    - 软盘数据以扇区（512字节）为单位进行读取
    - 指定数据所在位置的磁头号，拄面号，扇区号
    - 计算公式：
    ![](_v_images_/.png)


- BIOS中的软盘数据读取 (int 0x13)
    ![](_v_images_/.png)

- 软盘数据读取流程
    ![](_v_images_/.png)


- 汇编小贴士
    - 汇编中的16位除法操作（div )
        - 被除数放到 AX 寄存器
        - 除数放到通用寄存器或内存单元（8位）
        - 结果：商位于AL, 余数位于 AH

# 编程实验 磁盘数据的读取

# 小结
- 当汇编代码中定义了函数，那么也需要定义栈空间
- 读取数据前，逻辑扇区号需要转化为磁盘的物理位置
- 物理软盘上的数据位置由磁头号，柱面号，扇区号唯一确定
- 软盘数据以扇区（512字爷）为单位进行读取
