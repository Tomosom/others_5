畅游x86分页机制

- 有趣的问题                                  1 • 进 入 32位綱莫式代码后#应该在什么时候
                                            启动分页机制，并建立页表？
      i <i>
                                        2• 在 位 置 <1>和 位 置 <2>调用$61：叩?396的
     ; c a l l SetupPage                    执行效果是否相同？为什么？

    mov ebp, DTOS_OFFSET                                             yp
    mov bXj 0x0C
    mov dhj 12
    mov dL, 33

    caii Printstring

    mov ebp, HELLOJJORLD一OFFSET
    mov bXj 0x0C
    mov dh, 13
    mov dij 31

    caii Printstring

     i <2>
     i call SetupPage

狄泰未来          © 2018成都狄泰未来科技有限公司唐佐林孤频教程

畅游X86分页机制

- 当前页表的构建方式剖析

      物理地址：4096*(1024*2 + 4) + 0xABC

                   ◊

                                        0X00804ABC

狄泰未来          © 2018成都狄泰未来科技有限公司                                                     雜林臟教程

畅游x86分页机制

- 结论

         当前的分页方式使得：任意虚地址都被直接映射为物理地址，
         因此，SetupPage是否调用，以及调用位置不影响执行结果。

                                        分页方式          y:物理地址

                                        y = f(x) = x

狄泰未来          © 2018成都狄泰未来科技有限公司唐佐林孤频教程

畅游X86分页机制

- 页表验证实验
    _根据虚拟地址计算：k,j, offset
    -读取内存：PageDirBase + k * 4 + PageTbIBaseJ
    -读取内存：PageTbIBaseJ + j * 4 + PageBase
    -计算物理内存：PageBase + offset

狄泰未来          © 2018成都狄泰未来科技有限公司唐佐林孤频教程

The shortest answer is doing.

                 编程实验

                    页表验证实验

              从虚拟地址计算物理地址

狄泰未来          © 2018成都狄泰未来科技有限公司唐佐林孤频教程

畅游X86分页机制

- 页表映射实验

-创建多个页表，可自由切换当前使用的页表

-将同一个虚地址映射到不同的物理地址

-加载不同的页表，并读取同一个虚拟地址中的内容

      虛拟地址空间                                          物理地址空间

畅游X86分页机制

- 准备工作

-创建 InitPageTable 函数

•通过页目录地址，页表起始地址构建二级页表

-创建 SwitchPageTable 函数

•根据页目录起始地址切换页表，开启分页机制

; e a x - - > page dir base selector                  ; eax --> page directory base

; e b x - - > page table base selector                SwitchPageTabie:
; e c x - - > page table base
                                                            • ....
InitPageTable:                                              ret
      9• .... >

       ret

---------------------------------我是可爱的页面分割线-------------------------------------
狄泰未来   ◎ 2018成都狄泰未来科技有限公司

The shortest answer is doing.

       编程实验

        页表映射实验

            准备工作一

狄泰未来   ◎ 2018成都狄泰未来科技有限公司

 实战预告

-  To be continued …

                 思考：
                 在保护模式下，如何在指定的物理内存处写入数据?

狄泰未来              春'

       ◎ 2018成都狄泰未来科技有限公司

  狄泰未来

在这里收获的是未来，而不只是技术!

                  交流群：199546072

                  ◎ 2018成都狄泰未来科技有限公司

---------------------------------我是可爱的页面分割线-------------------------------------
