畅游x86分页机制

■问题
           在保护模式下，如何在指定的物理内存处写入数据?

狄泰未来                             © 2018成都狄泰未来科技有限公司                          唐佐林_教程

畅游x86分页机制

■平坦内存模型
    -将整个物理内存作为一个段处理
    -因此，段起始地址为〇,段大小为物理内存容量
    -保护模式下，可定义平坦内存段描述符（最多访问4G内存)

狄泰未来                             © 2018成都狄泰未来科技有限公司                          唐佐林_教程

畅游x86分页机制

■平坦内存模型示例
1 •段描述符

   FLAT MODE /?W DESC : Descriptor 0, ©xFFFFF, DA DRW + DA LIMIT 4K + DA 32

2•选择子                            equ (0x0009 << 3) + SA—TIG + SA—RPL0

    FLatModeRWSeLector

3.内存访问

      mov ax, F LatModeRfA/Se L ec tor
      mov es, ax
     mov ecx, [es:0x00FF00FF] ; read memory directly without page mechanism

狄泰未来                             © 2018成都狄泰未来科技有限公司                          唐佐林_教程

畅游X86分页机制

■页表映射实验

-创建多个页表，可自由切换当前使用的页表

-将同一个虚地址映射到不同的物理地址

-加载不同的页表f并读取同一个虚拟地址中的内容

      虚拟地址空间                                         物理地址空间

畅游x86分页机制

■实现思路
    -准备数据
          • 在 地 址 0 x501000处写入字符串（"DT〇S!")
          • 在 地 址 0 x601000处写入字符串（"HelloWorld!")

     一改写页表

          • 在 页 表 0 中 将 0 x401000映射到0x501000
          • 在 页 表 1 中 将 0 x401000映射到0x601000

狄泰未来                             © 2018成都狄泰未来科技有限公司                          唐佐林_教程

畅游x86分页机制

■验证实验                                    物理地址空间

             虚拟地址空间

              0x401000

                                 ♦ 页表。   4 0x501000 nos!，，

                                 ♦ I页表1     0x601000 'Hello World!”

SwitchPageTable : PageO 今 Printstring : 0x401000 今"D.T.OS!"
SwitchPageTable : Pagel 今 Printstring : 0x401000 今"Hello World!"

狄泰未来                             © 2018成都狄泰未来科技有限公司                          唐佐林_教程

畅游x86分页机制

■准备工作

-创建MemCpy32函数

• 32位保护模式下的内存拷贝函数

-创建MapAddress函数

•在页表中将虚地址映射到目标物理地址

;es --> flat mode                        ;es --> flat mode

; d s : e s i - - > source               ; e a x - - > virtual address
; e s : e d i - - > destination          ; e b x - - > target address
; e c x - - > length                     ; e c x - - > page directory base

MemCpy32:                                MapAddress :

ret                                                  ret

---------------------------------我是可爱的页面分割线-------------------------------------
狄泰未来   ◎ 2018成都狄泰未来科技有限公司

The shortest answer is doing.

       编程实验

        页表映射实验

           准备工作二

狄泰未来   ◎ 2018成都狄泰未来科技有限公司

 实战预告

■ To be continued ...

                      思考：
                      如果虚地址映射的实地址是一个函数入口,
                      那么是否可以进行函数调用？

  狄泰未来

在这里收获的是未来，而不只是技术!

               交流群：199546072

                  ◎ 2018成都狄泰未来科技有限公司

---------------------------------我是可爱的页面分割线-------------------------------------
