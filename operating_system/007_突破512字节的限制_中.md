突 破 512字 节 的 限 制

■突破限制的预备工作

狄泰料絲                            ©2018                                                                          m&mmmm

突破512字节的限制

■整体思路

突破512字节的限制

■问题

                                如何在根目录区中查找目标文件？

狄泰一+未来                          © 2018,成都狄泰未来科技有限公司                                                            唐佐林视^频教程

突破512字节的限制

■通过根目录项的前11个字节进行判断

                                      int d = fn-lastlndexOfC'.");
                                     QString name = QString(re.DIR_Name).trimmed();

                                     if( d >= 0 ) {
                                             QString n = fn.mid(0, d);
                                             QString p = fn.mid(d + 1);

                                             if( name.startsWith(n) && name.endsWith(p) ) {
                                                     ret = re;
                                                     break;

                       >

                                      } else {
                                             if( fn == name ) {
                                                     ret = re;
                                                     break;

狄泰料絲                            ©2018                                                                          m&mmmm

突破512字节的限制

■内存比较

-指定源起始地址（DS: SI)

-指定目标起始地址（ES:DI)

-判断在期望长度（CX )内^■^字节是否都相等

                         I                   CX                                                             \

        DS： SI ^^ ^~^^^                        I                                                    ^^

                                                 ~

                                II II II II                                                             II

        ES ： DI ^

狄泰一+未来                          © 2018,成都狄泰未来科技有限公司                                                            唐佐林视^频教程

突破512字节的限制

■汇编小贴士
    一汇编中的比较与S赂专

          ♦魄：
                cmpcx, 0 ;比较cx的值是否为〇

          ♦ 跳转：
                jz equal ;如果比较的结果为真，则©_到equal标签处

狄泰料絲                            ©2018                                                                          m&mmmm

突破512字节的限制

■汇编小贴士

                                ; d s : s i - - > source
                                ;es:di --> destination
                                ;cx --> length

      compare:                                            while( cx > 0 )                                      // compare
             cmp cx, 0
             jz equal                                     {
             mov al, [si]
             cmp al, byte [di]                                                               al = *si;
             jz goon
             jmp noequal                                                                     if( al != *di )

      goon:                                                                                         break;     // noequal
             inc si
             inc di                                                                          si++;             // goon
             dec cx
                                                                                             di++;
             jmp compare
                                                                                             cx--;

                                                          }

                                                          // (cx == 0) ? equal : noequal

---------------------------------我是可爱的页面分割线-------------------------------------
狄泰一+未来           ◎ 2018成都狄泰未来科技有限公司                                                        唐佐林娜教程

The shortest answer is doing.

                 编程实验

                 内存比较函数
                    MemCmp

狄泰一+未来           ◎ 2018成都狄泰未来科技有限公司                                                        唐佐林娜教程

突破512字节的限制

■查找根目录区是否存在目标文件

                                                                                  noexist

                           Y

                         MemCmp

        指^找次数dx

                         :es \|/

                           add bx, 32
                              dec dx

突破512字节的限制

■加载根目录区

        mov ax, 1 9      ;从第19逻辑扇区开始
        mov cx, 1 4
        mov bXj Buf      ;连续读取14个扇区

        call ReadSector  ; 渎 取 至 Buf 中

狄泰一+未来           © 2018,成都狄泰未来科技有限公司                                                       唐佐林视^频教程

突破512字节的限制

■汇编小贴士

    -访问栈空间中的栈顶数据
          ♦ 不能使用sp直接访问桟顶数据

           ♦ 通过其它通用寄存器间接访问栈顶数据

                                            push cx
                                           mov bp, sp

                                           mov cx, [bp] ; ERROR --> mov cx, [sp]

狄泰—+未来   ◎ 2018,成都狄泰未来科技有限公司                                                               唐佐林视^频教程

The shortest answer is doing.

                  编程实验

                 根目录区查找函数
                       FindEntry

狄泰一+未来           © 2018,成都狄泰未来科技有限公司                                                       唐佐林视^频教程

 小结

■可通过查找根目录区判断是否存在目标文件

    -加载根目录区至内存中（ ReadSector)
    -遍历根目录区中的每一项（FindEntry )
    -通过每一项的前11个字节进行判断（MemCmp )
    -当目标不存在时，打印错误信息（Print)

狄泰一+未来           © 2018成都狄泰未来科技有限公司                                                        唐佐林彳见顷教程

  狄泰未来

在这里收获的是未来，而不只是技术!

             交流群：199546072

                  ◎ 2018成都狄泰未来科技有限公司

---------------------------------我是可爱的页面分割线-------------------------------------
