# 8259A控制编程
- 一般来说
    - x86系统中使用2个8259A级联作为中断代理

- 问题
    如何具体的设置和控制8259A ?

-  8259A的设置与控制
    - 初始化命令字（Initialization Command Word)
    - 用于确定是否需要级联，设置起始中断向量，等
        - ICW1:初始化8259A连接方式和中断触发方式（如：设置主从级联)
        - ICW2:设置起始中断向量（IR0对应的中断向量）
        - ICW3:指定主从8259A的级联引脚（如：从片连接到主片IR2)
        - ICW4:设置8259A的工作模式（中断嵌套方式）

- ICW1 : 初 始 化 8 2 5 9 A连接方式和中断触发方式
        765 43 2 10
        000 10 0 01
                       I------► IC4: x86系统必须为1
                       I--------------► SNGL:                       1- 单 片
             I----------------------- ► LTIM: 0-边测泼；1-电平触发
             -------------------------------------- ► ICW1 固 定 ^^£
             注：ICW1需要写入主片的0x20端口和从片的OxAO端口

-  ICW2 : 设 置 起 始 中 断 向 量 （ IR0对应的中断向量）
             7 6 5 4 3 2 10
             XX XX X 0 00
             起始中断向量，必  IR0:000
               为8的整数倍  IR1 ：〇〇1
             注：丨CW2需要写入主片的0x21端口和从片的0xA1端口

-  丨CW3 : 指 定 主 从 8 2 5 9 A的级联弓丨脚
        主片:  76543210  1 00
             000 00
        从片:                                                        - W+从片连接至IR2引脚
             76543210
             0 0 0 0 0 () 1 0
                                      标识自身连接至主片IR2引脚
             注：ICW3需要写入主片的0x21端口和从片的0xA1端口

-  ICW4 : 初 始 化 8 2 5 9 A数据连接方式和中断触发方式
  7 6 5 4 3 2 10
   00 00 0 0 01
                 uPM: x86系统必须为1
                AEOI: *1-自动结束中断；0-手动结束中断
  M/S:缓冲模式：1-主片；0-从片
      非缓冲模式：〇 (无意义）
BUF: 0-非缓冲模式；1-缓冲模式
SFNM: 0- 餓 套 槪
1 -觀雜套槪
注：ICW4需要写入主片的0x21端口和从片的0xA1端口

# 实例分析 使用icw进行初始化

-  8259A的设置与控制
    - 操作命令字（Operation Command Word)
    - 用于设置中断优先级方式，中断结束模式，等
        - 〇CW1:屏蔽连接在8259A上的中断源
        - OCW2:设置中断结束方式和优先级模式
        - 〇CW3:设置特殊屏蔽方式及查询方式

-  0CW1 : 屏 蔽 连 接 在 8 2 5 9 A上的中断源
    -〇CW1命令字最终写入IMR寄存器
    • IMR寄存器为初级中断屏蔽寄存器（分开关）
    •如果标志寄存器中的IF位为◦,则屏蔽所有外部中断（总开关)

    注 ： OCW1 需 要 写 入 主 片 的 0 x2 1 端 口 和 从 片 的 0 xA1 端 口

-  0CW2:设置中断结束方式和优先级模式
76 54        3 2 10
R SL E0 I 0  0 L2 L1 L0
  0CW2固定标记
「手动结束中断时有意义（ICW4.AEIO==0)
• 0-无惠义
 -1 -结束中断，清除ISR相应位
丨0 _结束正在处理的中断，将ISR优先级最高位清除
'Ll -便用低三位（L2 - L0)指定需^束的中断
j0_固定优IR接 口 号 紙 优 高
11 -循 环 优 龄 IR接口优规在〇 - 7循环
注 ： 0 CW2 需 要 写 入 主 片 的 0 x2 0 端 口 和 从 片 的 0 xA0 端 口

-  OCW3:设置特殊屏蔽方式及查询方式
7 6 5 4 3 2 10
0 ESMM SMM 0 1 P RR RIS
~~^~~                    )- 0-读取IRR寄存器的值
                 仫-读取ISRS^i的值
I_________无意义
                  "h-读取雜器
                  「0-无意义
                  "Li-中 命 令 ， 飾 当 前 最 高 中 断 优 織
I------------------------------------ ► OCW3固定标记
     r〇-
     11 -
          ;o - 关 闭 蔽 獻
     ^ 11 -启 用 !tm藤 觀
注：OCW3需要写入主片的0x20端口和从片的0xA0端口

# 实例分析 使用ocw进行控制

# 小结
- 英特尔架构的中断系统由中断管理和中断处理构成
- 处理器负责响应中断以及执行中断服务程序
-  8259A负责管理中断和裁决中断
    -8259A是一种可编程中断控制器（PIC)
          • ICW控制字用于初始化配置
          • OCW控制字用于中断结束及优先级设置
