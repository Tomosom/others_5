# Hello, DT〇S!
- 问题
    - 主引导程序是软件还是固件？
    - 如果是软件, 那么由谁开发？如何开发？

- 主引导程序
    - 一段存储在主引导区（MBR )中的有效代码
    - 并不固化于硬件，属于操作系统代码的一部分
    - 启动操作系统内核的桥梁，由汇编程序写成
    - 代码总量不能超过 512 个字节（包含0x55aa )

- 主引导程序的开发
    ![](_v_images_002/1.png)

- 课程实验
    - 编写一个主引导程序 (汇编语言）
    - 可独立运行于x86架构的主机（无操作系统）
    - 运行后在屏幕上打印"Hello, DTOS!"

- 实现思路
    1. 将关键寄存器的值设置为0
        ```x86asm
        mov ax, 0
        ```
    2. 定义需要打印的数据
        ```x86asm
        db "Hello,D.T.OS!"
        ```
    3. 打印预定义好的字符数据
        ```x86asm
        int 0x10
        ```

- 汇编小贴士一
    - mov : 赋值操作，将右操作数赋值给左操作数
        ```x86asm
        mov ax, 0 ;将0赋值绐ax寄存器
        ```
    - int : 触发中断
        ```x86asm
        int 0x10 ;触发0x10中断，对屏幕进行操作
        ```
    - hlt : 停止运行，CPU进入暂停状态，不执行任何操作
        ```x86asm
        hlt ;使程序进入睡眠状态
        ```

- 汇编小贴士二
    - 汇编中地址的访问方式：段地址：段内偏移地址
        ```x86asm
        mov byte [0xb800:0x01], 0x07 ; 0xb800:0x01 -> 0xb8000 + 0x01
        ```
    - 标签
        - 用于标识后续指令的地址（可等同为C语言中的标签）
    -  $ vs $$
        - $ 表示当前指令行地址，$$ 表示当前汇编段起始地址

- 中断调用 vs 函数调用
    - 在屏幕上打印一个字符
    ![](_v_images_002/2.png)

# 编程实验 第一个引导加载程序

# 问题
- 如何验证编写的主引导程序？

- 解决方案设计
    - 将汇编源码编译为二进制机器码（nasm )
    - 创建虚拟盘（bximage )
    - 将二进制代码写入虚拟盘起始位置（dd )
    - 在虚拟机中将虚拟盘作为启动盘执行（vmware )

- 实验原材料
    - nasm
        - nasm boot.asm -o boot.bin
    - bximage
        - bximage a.img -q -fd -size=1.44
    - dd
        - dd if=boot.bin of=a.img bs=512 count=1 conv=notrunc

# 编程实验 运行引导加载程序


# 小结
- 主引导程序的代码量不能超过512字节
- 主引导程序需要使用汇编语言开发
- 主引导程序中可以通过BIOS中断使用硬件功能
- 主引导程序运行于实模式（地址都是实际的物理地址)
