# 保护模式中的特权级
- 问题
    使用调用门如何实现不同特权级代码之间的跳转（如：从高特权级到低特权级）？

- 不幸的事实
    - 调用门只支持从低特权级跳转到高特权级执行
    - 无法利用调用门从高特权级跳转到低特权级执行

- 调用门的特权级跳转分析
    ![](_v_images_/.png)

- 思路整理...
    - 调用门的特权级跳转
        1. 通过远调用（call far) : 低特权级+高恃权级
        2. 通过远返回（retf) :高特权级+低特权级
    > 远返回(retf)能够实现高特权级到底特权级的代码跳转, 那么, 考虑如何利用其机制完成这个跳转

- 再论函数调用的过程（近调用）
    ![](_v_images_/.png)
-  再论函数调用的过程（远调用）
    ![](_v_images_/.png)

- 需要提前知道的事实
    - x86处理器对于不同的特权级需要使用不同的栈
    - 每一个特权级对应一个私有的栈（最多4个栈）
    - 特权级跳转变化之前必须指定好相应的栈

- 解决方案（高特权级+低特权级）
    1. 指定目标栈段选择子（push)
    2. 指定栈顶指针位置（push)
    3. 指定目标代码段选择子（push)
    4. 指定目标代码段偏移（push)
    5. 跳转（ retf)

# 编程实验 高特权级+低特权级

# 小结
- 调用门只支持从低特权级跳转到高特权级执行
- 利用 远返回（retf) 可以从高特权级转移到低特权级
- x86处理器中每一个特权级对应1私有的栈
- 特权级跳转变化之前必须指定好相应的栈
