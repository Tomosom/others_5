保护模式中的特权级

■问题

                      使用调用门如何实现不同特权级代码之间
                      的勒啭（如：从高特权级到低特权级）？

狄泰未来                      ◎ 2018成都狄泰未来科技有限公司               唐佐林视^频教程

保护模式中的特权级

■不幸的事实
    -调用门只支持从低特权级周辟专到高特权级执行
    -无法利用调用门从高特权级瑕赌到低特权级执行

狄泰夺+未来                    ◎ 2018成都狄泰未来科技有限公司               唐佐林彳见顷教程

保护模式中的特权级

■调用门的特权级跳转分析

狄泰未来                      © 2018成都狄泰未来科技有限公司               唐佐林彳见顷教程

保护模式中的特权级

■思路整理。〇 〇
    -调用门的特权级周辟专
         1. 通过远调用（call f a r ) : 低特权级+高恃权级
         2 . 通过远返回（r e t f ) :高特权级+低特权级

保护模式中的特权级

■ 再论函数调用的过程（近调用）

                          高地址                              高地址

push ax                   ax               _____ K         ax
push bx
                          bx               ret找的栈〉esp —>   bx
call func
                          esp ——> eip                      eip
pop bx
pop ax

func:
     ret

                          1 獅址                             獅址

狄泰一+未来                    ◎ 2018成都狄泰未来科技有限公司               唐佐林麵教程

保护模式中的特权级

■ 再论函数调用的过程（远调用）

push ax
push bx

call XXSelector : xxfunc

pop bx                                 ax           K           ax
pop ax
                                       bx     retf 的栈〉esp       bx
[secion . x x ]
X X 一S E G M E N T :                   cs           !/          cs

func:                     esp ——> eip                          eip
      retf

xxfunc equ func - $$

狄泰一今未来                    ◎ 2018成都狄泰未来科技有限公司               唐佐林视频教程

保护模式中的特权级

■需要提前知道的事实
    -x86处理器对于不同的特权级需要使用不同的栈
    -每一^特权级对应一^私有的栈（最多4个栈）
    -特权级®赌变化之前必须指定好相应的栈

---------------------------------我是可爱的页面分割线-------------------------------------
狄泰一+未来  ◎ 2018成都狄泰未来科技有限公司

保护模式中的特权级

■解决方案（高特权级+低特权级）
      1•指定目标栈段选择子（push)

    2. 指定栈顶指针位置（push)
    3. 指定目标代码段选择子（push)
   4•指定目标代码段偏移（push)
    5 • 招 啭 （ retf)

狄泰一+未来  ◎ 2018成都狄泰未来科技有限公司

The shortest answer is doing.

          编程实验

        高特权级+低特权级

狄泰一+未来  ◎ 2018成都狄泰未来科技有限公司

 小结

■调用门只支持从低特权级®辟专到高特权级执行
■ 利 用 远 返 回 （retf )可以从高特权级转移到低特权级
■ x86处理器中每一^特权级对应1私有的栈
■特权级®赌变化之前必须指定好相应的栈

狄泰一+未来  ◎ 2018成都狄泰未来科技有限公司

To be continued …

■问题

        选择子中的RPL究竟有什么用？

狄泰一+未来  ◎ 2018成都狄泰未来科技有限公司

         狄泰未来

        在这里收获的是未来，而不只是技术!
                 交流群：199546072

                    ◎ 2018成都狄泰未来科技有限公司

---------------------------------我是可爱的页面分割线-------------------------------------
