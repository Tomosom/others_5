深入浅出x86中断机制

- 最初的接触

        在屏幕上打印一个字符

狄泰夺♦ 絲  ©2〇18                                              離林臟教程

深入浅出x86中断机制

- 问题

        系统中的中断究竟是什么？

狄泰未来    © 2018成都狄泰未来科技有限公司                                 離林臟教程

深入浅出x86中断机制

- 工作中。。。

         -软件工程师小狄，正在集中精神解决系统性能问题，这时:
          •同事发来消息，求助技术问题

                       ^处理方式：不理会，先解决性能问题
               •老板发来消磨、，要求召开紧急会议

                       ^处理方式：立即保存当前的工作，前往会议现场

狄泰未来    © 2018成都狄泰未来科技有限公司                                 唐佐林_教程

深入浅出x86中断机制

-  义结束后。〇 〇
    -小狄回到工位，继续解决性能问题

           •再次收到同事的技术求助
           •处理方式：不理会，先解决性能问题

               Z同事相当郁闷。。。

狄泰夺♦ 絲  ©2018                                              无奈的同事

                                                                離林臟教程

深入浅出x86中断机制

- 小狄的工作状态。。。

                  | 2: worfc_on_issw()

                  I^                    6: back to work()

        7: helpQ  If

                  | 8: work.onJssue<)

深入浅出x86中断机制

- 小狄的工作方式

     -在处理紧急事务的时候，不回应同事的技术求助
     -老板的召唤必须回应，不能耽搁
     -处理完老板的召回后，继续处理之前的紧急事务
     -同事的技术求助继续不回应

狄泰未来    © 2018成都狄泰未来科技有限公司唐佐林_教程

The shortest answer is doing.

                  编程实验

                  小狄的工作曰常

---------------------------------我是可爱的页面分割线-------------------------------------
狄泰          © 2018成都狄泰未来科技有限公司         離林臟教程

深入浅出x86中断机制

- 中断的概念和意义

    -概念：

     •正在执行任务时，出现某个请求            ________________

          ，暂停当前任务，转而处理这个请求类似函数调用

          ^处理结束后继续任务的执行

    -意义：

     •中断是提高系统整体性能的必要方式

狄泰未来        © 2018成都狄泰未来科技有限公司         唐佐林_教程

深入浅出x86中断机制

- 处理器与外设的拓扑结构

狄泰未来        © 2018成都狄泰未来科技有限公司         唐佐林_教程

深入浅出x86中断机制

- 中断与外设
    -中断是一种处理器与外设进行通信的机制
    -用于"通知〃处理器外部有〃重要事件"发生
    -一般情况下，中断需要被处理器响应

狄泰未来        © 2018成都狄泰未来科技有限公司         唐佐林_教程

深入浅出x86中断机制

- 本质

           操作系统是中断驱动的死循环!

狄泰未来        © 2018成都狄泰未来科技有限公司         唐佐林_教程

The shortest answer is doing.

               编程实验

            处理器，中断，操作系统

                        本质剖析

狄泰未来        © 2018成都狄泰未来科技有限公司         唐佐林_教程

深入浅出x86中断机制

- 中断的分类

            4 '广-  外部中断       不可屏蔽中断（INTR)
                   内部中断
            一            K] 可屏蔽中断(NMI)

     处理器中断      V               软中断

                         ©           p( 故 障 （ Fault)

                            /
                         H 异 常 岭 ― 陷 讲 （ Trap： )

                                       终 止 （ Abort)

狄泰未来        © 2018成都狄泰未来科技有限公司         唐佐林_教程

深入浅出X86中断机制

    - 中断的分类
     一夕卜部中断

              •来自于处理器外部设备的中断请求
        -内部中断

              •程序执行时，自身主动发出的中断请求（软中断）
              •程序执行时，处理器产生了指令错误（异常）

---------------------------------我是可爱的页面分割线-------------------------------------
狄泰未来       © 2018成都狄泰未来科技有限公司                                                                                唐佐林_教程

深入浅出x86中断机制

- 小狄解决问题时可能的中断
    -可屏蔽中断：同事的技术求助
    -不可屏蔽中断：老板要求马上参加技术会议
    -软中断：人有三急，需要途中上厕所
    -异常：误删一个源码文件，必须重新到服务器下载

狄泰未来       © 2018成都狄泰未来科技有限公司                                                                                唐佐林_教程

深入浅出x86中断机制

- 处理器的外部中断

狄泰未来       © 2018成都狄泰未来科技有限公司                                                                                唐佐林_教程

深入浅出x86中断机制

- 处理器的内部中断

      mov bx, 0x0f                                                                              mov ax, 100
      mov ah, 0x0e                                                                              mov bx, 0
      mov al, 1c'
      int 0x10                                                                                   div bx

           软中断                                                                                  异常（Fault)

狄泰未来       © 2018成都狄泰未来科技有限公司                                                                                唐佐林_教程

深入浅出x86中断机制

- 问题

           处理器接收到中断请求后，
           如何具体的对中断进行处理？

狄泰未来       © 2018成都狄泰未来科技有限公司                                                                                唐佐林_教程

深入浅出x86中断机制

- 中断服务程序（丨nterruPt Service R〇utine)
          对于处理器而言，处理中断的方式就是执行一段事与
                 好的代码，这段代码叫做中断服务程序。

                   中断服务程序由操作系统内核提供!

狄泰         © 2018成都狄泰未来科技有限公司                                                                              離林臟教程

深入浅出x86中断机制                                                                                     Device

-  中断处理流程                                                                     :interruptO

                            Processor                                   get int©rrupt_typ©()
                                            * : sav©_current_context()  4 interrupt type()

                           ]

                                                 doproc©ss()

                                                                        clear interrupt flag()

      clear_int©rrupt_flag()

      restore context()

深入浅出x86中断机制

-  Linux中断处理方式
    -为了缩短处理器对中断的响应时间，可以把中断分为:
          •中断上半部（ISR)

                z中断应答或硬件复位等重要紧迫的工作

                  ，实时性要求高，不可被打断

          •中断下半部

---------------------------------我是可爱的页面分割线-------------------------------------
      y相对耗时的数据处理工作，后续调度执行

狄泰未来  ◎ 2018成都狄泰未来科技有P艮公司                      雛林麵教程

The shortest answer is doing.

       编程实验

      中断应答案例分析

深入浅出x86中断机制

-  To be continued ...

                  思考：

                      中断与对应的服务程序间如何建立关联?

                                 在代码层面如何进行转移？

---------------------------------我是可爱的页面分割线-------------------------------------
