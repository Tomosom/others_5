# 突破 512 字节的限制

- 整体思路
![](_v_images_/.png)

- 最后的冲刺
    - 备份目标文件的目录信息（MemCpy )
    - 加载Fat表，并完成Fat表项的查找与读取（FatVec )

- 备份目标文件的目录信息（内存拷贝）
![](_v_images_/.png)

- MemCpy实现要点：拷贝方向
![](_v_images_/.png)

- 汇编小贴士

| 汇编指令 | 功能 |
| ------- | --- |
| ja      | >    |
| jna     | <=   |
| jb      | <    |
| jnb     | >=   |

```x86asm
cmp si, di
ja btoe ; if( si > di )
; ......
; ......
btoe :
; ......
; ......
```

# 编程实验 内存拷贝函数 MemCpy

- Fat表项的读取
    Fat表中的每个表项占用1.5个字节，即 : 使用3个字节表示2个表项
    ![](_v_images_/.png)

- Fat表项的"动态组装"

    | FatVec下标（偶数） | FatVec下标（奇数） | 起始字节 |
    | ----------------- | ----------------- | ------- |
    | j= 0              | j =1              | i= 0    |
    | j= 2              | j =3              | i= 3    |
    | j= 4              | j =5              | i= 6    |
    | j= 6              | j =7              | i= 9    |
    | j= 8              | j= 9              | i = 12  |
    > 对应关系：i = j/ 2 * 3

- FatVec[j] 的 "动态组装"
    - j = 0 , 2 , 4 , 6 , 8, ……
    - i = j / 2 * 3 → (i,j均为整型数)
    - FatVec[j] = ((Fat[i+1] & 0x0F) << 8) | Fat[i];
    - FatVec[j+1] = (Fat[i+2] << 4) | (( Fat[i + 1] >> 4) & 0x0F);

- 汇编小贴士
    - 汇编中的16位乘法操作（mul)
        - 被乘数放到AL寄存器
        - 乘数放到通用寄存器或内存单元（8位)
        - 相乘的结果放到AX寄存器中

# 编程实验 Fat 项读取函数 FatVec

# 小结
- 内存拷贝时需要考虑进行拷贝的方向
    - 当si > di时，从前向后拷贝
    - 当si <= di时，从后向前拷贝
- Fat表加载到内存中之后，需要 "动态组装" 表项
    - Fat表中使用 3 个字节表示 2 个表项
    - 起始字节 = 表项下标/ 2 * 3 → (运算结果取整）
