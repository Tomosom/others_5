突 破 512字 节 的 限 制

■整体思路

突破512字节的限制

■最后的冲刺
    -备份目标文件的目录信息（MemCpy )
    一加载Fat表，并完成Fat表项的查找与读取（FatVec )

狄泰一+未来                      © 2018成都狄泰未来科技有限公司                                                                               唐佐林视•频教程

突破512字节的限制

■备份目标文件的目录信息（内存拷贝）

                      根目录区                      Entryltem

bx——>                                      DIR_Name                                                             0x00   OxOB  —32 Bytes
                                           DIR_Attr                                                             OxOB   0x01
                     白标文件根                 Reserve                                                              OxOC   OxOA
                      g录信息                 DIR一WrtTime                                                          0x16   0x02
                                           DIR_WrtDate                                                          0x18   0x02
                                           DIR一FstClus                                                          0x1A   0x02
                                           DIR FileSize                                                         0x1 C  0x04

狄泰一+未来                      © 2018成都狄泰未来科技有限公司                                                                               唐佐林视•频教程

突破512字节的限制

■ MemCpy实现要点：拷贝方向

从尾部向头部进行拷贝（si <= di )                      从头部向尾部进行拷贝（si > di )
 si——>
                                    <——di

/\

                                                                                                                             \/

狄泰一+未来                      © 2018成都狄泰未来科技有限公司                                                                                  唐佐林视•频教程

突破512字节的限制                                                                                                                    >
                                                                                                                             <=
■汇编小贴士                                                                                                                        <
                                                                                                                             >=
cmp sij di
ja btoe ; if( si > di )

j ........................................................................................................ ja

J ...................................................................................................... jna

btoe :                                     jb

;......................................................................................................... jnb

狄泰一+未来                      © 2018成都狄泰未来科技有限公司                                                                               唐佐林视•频教程

The shortest answer is doing.

                            编程实验

                              内存拷贝函数
                                MemCpy

狄泰一+未来                      © 2018成都狄泰未来科技有限公司                                                                               唐佐林视•频教程

突破512字节的限制

■ Fat表项的读取

                    Fat表中的每个表项占用1.5个字节，即:
                              使用3个字节表示2个表项

                                Byte
                                      1

        Fat iItem

FatVec

---------------------------------我是可爱的页面分割线-------------------------------------
狄泰一+未来        © 2018成都狄泰未来科技有限公司            唐佐林视频教程

突破512字节的限制

■ Fat表项的"动态组装"

        FatVec下标（偶数）FatVec下标（奇数）  起始字节

        j= 0    j =1                 i= 0
                                     i= 3
        j= 2    j =3                 i= 6
                                     i= 9
        j= 4    j =5                i = 12

        j= 6    j =7

        j= 8    j= 9

              对应关系：i = j/ 2 * 3

狄泰一+未来        © 2018成都狄泰未来科技有限公司            唐佐林视•频教程

突破512字节的限制

■ FatVec[j]的 " 动 态 组装〃

    ♦ j = 0 , 2 , 4 , 6 , 8, … …

    ♦ i = j / 2 * 3 今 （ i,j均 为 整 型 數 ）
    ♦ FatVecfj] = ( ( Fat[i + 1 ] & OxOF) < < 8 ) | Fat[ i] ;
    ♦ FatVec[j + l] = ( Fat[i + 2 ] << 4 ) | ( ( Fat[i + 1] >> 4 ) & OxOF );

狄泰一+未来        © 2018成都狄泰未来科技有限公司            唐佐林视•频教程

突破512字节的限制

■汇编小贴士
    一汇编中的16位乘法操作（mul)
         •被乘数放到AL寄存器
          •乘数放到通用寄存器或内存单元（8位)
         •相乘的结果放到AX寄存器中

狄泰令+未来        ◎ 2018成都狄泰未来科技有限公司

The shortest answer is doing

                编程实验

                 Fat项丨卖取函数
                     FatVec

狄泰一+未来        © 2018成都狄泰未来科技有限公司            唐佐林视•频教程

 小结

■内帮考贝时需要考虑进行拷贝的方向
    -当si > di时，从前向后拷贝
    -当si <= di时，从后向前拷贝

■ Fat表加载到内存中之后，需要〃动态组装〃表项
    -Fat表中使用3 个字节表示2 个表项
     -起始字节=表项下标/ 2 * 3 + (运算结果取整）

狄泰一+未来        © 2018成都狄泰未来科技有限公司            唐佐林视•频教程

        ◎ 2018成都狄泰未来科技有限公司

---------------------------------我是可爱的页面分割线-------------------------------------
