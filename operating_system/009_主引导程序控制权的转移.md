主引导程序控制权的转移

■ BootLoader内存布局

        512 Byte       4 KB
          \ j________________________ i

        fr

Stack   Boot           Fat Table                                                                                             Loader

        0x7c00 0x7e00                                                                                          0x9000

狄泰一+未来            ◎ 2018成都狄泰未来科技有限公司                                                                                         唐佐林视^页教程

主引导程序控制权的转移

■通过FAT表加载文件内容

主引导程序控制权的转移

■实验步骤
     1•在虚拟软盘中创建体积较大的文本文件（Loader)
     2.将Loader的内容加载至[| BaseOfLoader地址处
     3 • 打 印 Loader中的文本（判断加载是否完全）

狄泰一今未来            ©2018成都狄泰未来科技有限公司                                                                                          唐佐林视频教程

The shortest answer is doing.

                    编程实验

                  Loader文件内容的加载

狄泰令+未来            〇 2018成都狄泰未来科技有限公司                                                                                         唐佐林彳见顷教程
                                                                                                                             唐佐林视频教程
主引导程序控制权的转移

■ 第 一 个 Loader程序

-起始地址 0x9000 ( org 0x9000 )

-通过int 0x10在屏幕上打印字符串

                  print:
                        mov al, [si]
                         add si, 1
                         cmp al, 0x00
                         je last ; jz last
                        mov ah, 0x0E
                        mov bx, 0x0F
                         int 0x10
                        jmp print

狄泰未来              last:

                                                                                                          —^—

                  ©2018成都狄泰未来科技有限公司

突破512字节的限制

■汇编小贴士：标志寄存器

15 14 13 12 11 10 9 8 7 6 5 4 3 2 1 0

                  OF DF IF TF SF ZF                                                                            AF      PF            CF

                                            零标志位

零标志位：                                                                                                          mov ax, 1     ;减法操作
•判断运算的结果是否为〇                                                                                                   cmp ax, 1
♦当运算的结果为〇时，ZF位的值为1                                                                                             jz Zf_is_0ne

                                                                                                               ;…
                                                                                                               zf is one:

狄泰一+未来            © 2018 狄泰未来科技有限公司                                                                                          唐佐林彳见频教程

突破512字节的限制

■汇编小贴士
    -jxx代表了 1指令族，功能是根据标志位进行调整

            • j〇 当 〇 F为 1 贝 [ | 跳 $ 专
            • jc当 CF为 1 则 跳 转
            • jns当 SF不 为 1 则 跳 转
            • jz当 ZF为 1 贝 IJS赂 专
            • je比 较 结 果 为 相 等 则 ( 即 ：jz )

---------------------------------我是可爱的页面分割线-------------------------------------
狄泰未来    ©2018成都狄泰未来科技有限公司             唐佐林视频教程

The shortest answer is doing.

        编程实验

          控制权转移

小结

■ Boot需要进行重构保证在512字节内完成功能
■在汇编程序中尽量确保函数调用前后通用寄存器的状态不变
■ Boot成功加载Loader后将控制权转移
■ Loader程序没有代码体积上的限制

狄泰夺+未来  ◎ 2018成都狄泰未来科技有限公司            唐佐林视频教程

  狄泰未来

在这里收获的是未来，而不只是技术
             交流群：199546072

                  ◎ 2018成都狄泰未来科技有限公司

---------------------------------我是可爱的页面分割线-------------------------------------
