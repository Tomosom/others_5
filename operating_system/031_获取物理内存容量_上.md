# 获取物理内存容量
-  讨论中 . . .
    ![](_v_images_/.png)

-  问题
    如何获取系统物理内存的大小?

- BIOS提供的内存相关中断（int 0x15)
    - 基础功能（eax= 0xE801)
        - 分别检测低15MB和高 16MB - 4GB 的内存
        - 最大支持 4GB 内存检测
    - 高级功能（eax=0xE820)
        - 遍历主机上所有的内存范围
        - 获取各个内存范围的详细信息

-  int 0x15基础功能
    - 中断参数
        -  eax = 0xE801
    - 返回值
        - cf ⇒ 成 功 0 , 出 错 1
        - ax, cx ⇒ 以 1 KB为单位，表示15MB以下的内存容量
        - bx, dx ⇒ 以64 KB为单位，表示16MB以上的内存容量

- 汇编小贴士 ：标志寄存器
    ![](_v_images_/.png)
    进位标志位 :
    - 判断运算过程是否进 / 借位
    - 运算不需要进 / 借位时 CF 位的值为 0, 否则为1

        ```x86asm
        xor ax, ax   ; 异或操作
                     ; 清零 CF 位
        jc cf_is_one
        ;…
        cf_is_one:
        ```
-  int 0x15 基础功能示例

    ```x86asm
      xor eax, eax     ; 清空 CF 标志位
      mov eax, 0XE801  ; 获取物理内存大小

      int 0x15

      jc geterr        ; 如果出错 CF 为1

      shl eax, 10      ; 15M以下内存容量
      shl ebx, 6       ; 16M以上内存容量
      shl ebx, 10
    ```

# 编程实验 获取物理内存容量

- 问题
    为什么0xE801获取的内存容量分两部分表示?
    为什么0xE801获取的内存容量少了 1MB?

- 一些历史原因。。。
    - 80286 中的24根地址线最大寻址范围是16 MB
    - 当时的 ISA 设备使用15MB以上的地址作为缓冲区
         - 操作系统无法使用15MB -16MB的物理内存
         - 80386 之后的处理器为了兼容，多余16MB的内存容量单独返回

    ![](_v_images_/.png)

-  eax = 0xE801获取内存容量的修正

    ```x86asm
      shl eax, 10  ;15M以下内存容量
      shl ebx, 6   ;16M以上内存容量
      shl ebx, 10

      mov ecx, 1   ;修正的内存容量
      shl ecx, 20

      ; [MEM-SIZE]
      ; eax + ebx + ecx
    ```

# 编程实验 获取物理内存容量 修正版

- 小推论
    - eax = 0xE801 所返回的是可实际使用的内存容量
    - 处理器对内存地址空间做了分段处理
- 问题
       是否能够获取处理器对内存地址进行分段的详细信息????
