获取物理内存容量

■ 讨论中。 〇 〇

               分页机制的关键是页请求和页置换。〇 〇
                                                        什么时候进行页:

               当然是没有空闲页框的时候需要进行页置换呀！！

         ^5 怎么知道还剩多少空闲页框？ 一共有多少页框可用?

狄泰                 © 2018成都狄泰未来科技有限公司                          酿林臟教程

获取物理内存容量

■ 问题

                 如何获取系统物理内存的大小?

狄泰                 © 2018成都狄泰未来科技有限公司                          酿林臟教程

获取物理内存容量

■ BIOS提供的内存相关中断（int 0x15)
    -基础功能（eax= 0xE801)
          •分别检测低15MB和高16MB-4GB的内存
          •最大支持4GB内存检测
    -高级功能（eax=0xE820)

           •遍历主机上所有的内存范围
           •获取各个内存范围的详细信息

狄泰未来               © 2018成都狄泰未来科技有限公司                          唐佐林_教程

获取物理内存容量

■ int 0x15基础功能
    -中断参数
          • eax = 0xE801
    -返回值
          • cf今 成 功 0 , 出 错 1
          • ax, cx今 以 1 KB为单位，表示15MB以下的内存容量
          • bx, dx今以64 KB为单位，表示16MB以上的内存容量

狄泰未来               © 2018成都狄泰未来科技有限公司                          唐佐林_教程

获取物理内存容量

■汇编小贴士 ：标志寄存器

    15 14 13 12 11 10 9 8 7 6 5 4 3 2 1 0

                   OF DF IF TF SF ZF             AF  PF        CF

                                                               进/借位标志位

    •判断运算过程是否进/借位                                xor ax, ax    异或操作

    • 运 算 不 需 要 进 / 借 位 时 CF位 的 值 为 0 , 否 则 为 1  •：.           清零CF位
                                                 jc cf_is_one
                                                 ;…
                                                 cf_is_one:

狄泰未来               © 2018成都狄泰未来科技有限公司                          酿林臟教程

获取物理内存容量

■ int 0x15基础功能示例

      xor eax^ eax     ;清空CF标志位
      mov eax^ 0XE801
                       ;获取物理内存大小

      int 0x15

      jc geterr        ;如果出错CF为1

      shl eax^ 10      ;15M以下内存容量
      shl ebx^ 6       ;16M以上内存容量
      shl ebx^ 10

狄泰未来               © 2018成都狄泰未来科技有限公司

The shortest answer is doing.

                        编程实验

                       获取物理内存容量

---------------------------------我是可爱的页面分割线-------------------------------------
狄泰未来               © 2018成都狄泰未来科技有限公司                                                                                                   唐佐林_教程

获取物理内存容量

■问题

      为什么0xE801获取的内存容量分两部分表示?
        为什么0xE801获取的内存容量少了 1MB?

狄泰未来               © 2018成都狄泰未来科技有限公司                                                                                                   唐佐林_教程

获取物理内存容量

■一些历史原因。。。
    -80286中的24根地址线最大寻址范围是16 MB

    -当时的ISA设备使用15MB以上的地址作为缓冲区

     •操作系统无法使用15MB -16MB的物理内存

     • 80386之后的处理器为了兼容，多余16MB的内存容量单独返回

      15MB                                16MB

                   内存黑洞

获取物理内存容量

■ eax = 0xE801获取内存容量的修正

      shl eax^ 10  ;15M以下内存容量
      shl ebx. 6   ;16M以上内存容量
      shl ebx. 10

      mov ecxj 1   ;修正的内存容量
      shl ecxj 20

      ；[MEM-SIZE]
      ;eax + ebx + ecx

                                                                                                                                    !l

狄泰未来               © 2018成都狄泰未来科技有限公司                                                                                                   唐佐林_教程

The shortest answer is doing.

                   编程实验

                   获取物理内存容量
                          修正版

狄泰未来               © 2018成都狄泰未来科技有限公司                                                                                                   唐佐林_教程

获取物理内存容量

■小推论
    - eax = 0xE801所返回的是可实际使用的内存容量
    -处理器对内存地址空间做了分段处理

■问题
       是否能够获取处理器对内存地址进行分段的详细信息????

狄泰                 © 2018成都狄泰未来科技有限公司                                                                                                   酿林臟教程

      狄泰未来

    在这里收获的是未来，而不只是技术!
                 交流群：199546072

                      © 2018成都狄泰未来科技有限公司

---------------------------------我是可爱的页面分割线-------------------------------------
