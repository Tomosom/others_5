保护模式中的特权级

■保护模式小结
    -使用选择子访问段描述符表时，索引值的合法性检测
          •当索引值越界时，引发异常
          •判断规则：索引值* 8 + 7 < =段描述表界限值

                      段描述符〇                    X
                      段描述符1
                      段描述符2                             唐佐林视^频教程
                      段描述符3

狄泰一+未来             © 2018成都狄泰未来科技有限公司

保护模式中的特权级

■保护模式小结
    -内存段类型合法性检测
         •具备可执行属性的段（代码段）只能加载到CS寄存器
         •具备可写属性的段（数据段）才能加载到SS寄存器
         •具备可读属性的段才能加载到DS, ES, FS, GS寄存器

狄泰一+未来             © 2018成都狄泰未来科技有限公司                                                                                                唐佐林视^频教程

保护模式中的特权级

■保护模式小结

-代码段和数据段的保护
     ♦处理器每访问_^地址都要确认该地址不超过界限值
     ♦判麵则：

             ，代码段：IP +指令长度 <=代码段界限

               ，数据段：访问起始地址+访问数据长度 <=数据段界限

                                                                                                                              异常段界限

              指令1     指令2     指令3         指令4
           、i

        段  基       地  址    正  常        段  界    限

保护模式中的特权级

注意

              保护模式中代码中定义的界限值通常为：
              最大偏移地址值（相对于段基地址h

狄泰一+未来             © 2018成都狄泰未来科技有限公司                                                                                                唐佐林视^频教程

Nothing seek, nothing find.

                      实例分析

                       保护模式小结

狄泰一+未来             © 2018成都狄泰未来科技有限公司                                                                                                唐佐林视^频教程

保护模式中的特权级

■问题

           保护t吳式除了利用段界限对内存访问进行保护，
                       是否®是供其它的保护机制？

狄泰一+未来             © 2018成都狄泰未来科技有限公司                                                                                                唐佐林视^频教程

保护模式中的特权级

■保护模式中的特权级
    一X86架构中的保护模式提供了 4个特权级（0, 1, 2, 3 )
    一特权级从高到底分别是0, 1, 2, 3 (数字越大特权级越低）

---------------------------------我是可爱的页面分割线-------------------------------------
狄泰一+未来                 ◎ 2018成都狄泰未来科技有限公司                         唐佐林娜教程

保护模式中的特权级

■特权级的表现形式
    -CPL (Current Privilege Level)
          ♦当前可执行代码段的恃权级，由CS寄存器最低2位定义
    - D P L (Descriptor Privilege Level)
          ♦内存段的特权级，在段描述符表中定义
    - R P L (Request Privilege Level)
          ♦选择子的特权级，由选择子最低2位定义

狄泰一+未来               © 2018成都狄泰未来科技有限公司                           唐佐林视^频教程

保护模式中的特权级

■初探特权级

31--24 23 22 21 20 19—16 15 14-13 12 11 — 8 7—0

段基址     G  D/B    L    AVL    段界限    P  DPL  S TYPE        段基址    高32位

31 -24                      19 - 16                      23 - 16

           31-16                             15-0

           段基址15 -- 0                        段界限15 -- 0           低32位

段描述符中的DPL用于标i只内存段的特权级；可执行代码访问内
存段时必须满足一定恃权级（CPL ),否则，处理器将产生异常。

狄泰一+未来                 © 2018成都狄泰未来科技有限公司                         唐佐林视^频教程

保护模式中的特权级

■ CPL和DPL的关系
    一保护模式中，每一尤码段都定义了一^ DPL
    一当处理器从A代码段成功瑕赌到B代码段执行
          • _之前：CPL = DPLa
          • 繼 之 后 ： CPL = DPLb

狄泰一+未来               © 2018成都狄泰未来科技有限公司                           唐佐林视^频教程

保护模式中的特权级

■ CPL和DPL的关系
    一保护模式中，每一^数据段都定义了一^ DPL

     -当处理器执行过程中需要访问数据段时：

                                     CPL<= DPLdata

狄泰一+未来                 © 2018成都狄泰未来科技有限公司                         唐佐林视^频教程

保护模式中的特权级

■ 段 描 述 符 中 的 DPL常量定义

           DA一 DPL0         mm               意义

           DA DPL1          0x00             DPL: 0
                            0x20             DPL: 1
           DA一 DPL2         0x40             DPL: 2
                            0x60             DPL: 3
           DA DPL3

狄泰夺+未来               ◎ 2018成都狄泰未来科技有限公司                           唐佐林视，频教程

The shortest answer is doing.

                        编程实验

                       保护模式特权级初探

狄泰一+未来                 © 2018成都狄泰未来科技有限公司                         唐佐林视^频教程

保护模式中的特权级

■实验结论
    -处理器进入保护模式后CPL = 0 (最高特权级）

     -处理器不能菌妾从高特权级转麵底鎌级执行

    - 选 择 子 RPL大于对应段描述符的DPL时，产生异常

---------------------------------我是可爱的页面分割线-------------------------------------
狄泰夺+未来  ◎ 2018成都狄泰未来科技有限公司        唐佐林视频教程

保护模式中的特权级

■引出的问题
    -如何在不同特权级的代码段之间遇啭执行？
    -高特权级代码为什么不能使用低特权级栈段？
    -选择子的RPL具体有什么用？

        f

                        ■ To be continued ...

狄泰未来    ©2018成都狄泰未来科技有限公司         唐佐林视频教程

 小结

■保护模式对内存的访问范围有严格定义
■保护模式定义了内存段的特权级（〇, 1, 2, 3 )

    -每个内存段都有固定的特权级（DPL )
    -不同代码段之间成功®齡后CPL可能发生改变
    _ CPL小于或等于謝居段DPL才能成功访问数据

狄泰夺+未来  ◎ 2018成都狄泰未来科技有限公司        唐佐林视频教程

        狄泰未来

        在这里收获的是未来，而不只是技术!
              交流群：199546072

              ◎ 2018成都狄泰未来科技有限公司

---------------------------------我是可爱的页面分割线-------------------------------------
