# 主引导程序的扩展
- 问题
    - <font color=blue>如何在FAT12根目录中查找是否存在目标文件？</font>

- <font color=blue>根目录区</font>的大小和位置
    ![](_v_images_005/1.png)
    > 从第19扇区开始, 总共14个扇区
    > 记录的是软盘中根目录中的所有文件项(文件大小,修改信息等)
    > 占用扇区个数的计算方法 : 文件格式的头信息中可读取相关信息
    > BPB_RootEntCnt : 根目录区用多少个文件项
    > sizeof(RootEntry) : 每个文件项的大小 (占32个字节)
    > BPB_BytsPerSec : 每个扇区所占大小 (512字节)
- FAT12文件系统中的根目录区
    根目录区由<font color=red>目录项</font>构成，每一个目录项代表根目录中的一T文件索引。
    ![](_v_images_005/2.png)
    > 簇是比扇区更大的概念. 对fat12来说, 一个簇就是一个扇区

- 实验 : 读取FAT12文件系统的根目录信息
    - 步骤：
        - 创建 RootEntry 结构体类型 (根据前面的表格)
        - 使用文件流顺序读取每个项的内容
        - 解析并打印相关的信息

# [<u>编程实验 读取根目录信息</u>](code/005_master_boot_extend_2)



- 目录项的中的关键成员
    - DIR Name
        - 文件名（用于判断是否为目标文件)
    - DIR_FstClus
        - 文件数据起始存储位置（用于确定读取位置)
    - DIR_FileSize
        - 文件大小（用于确定读取的字节數）


-  FAT表-FAT12的数据组织核心
    - FAT1 和 FAT2 是相互备份的关系，数据内容完全一致
    - FAT表是一个关系图，记录了文件数据的先后关系
    - 每一个FAT表项暂用12比特
    - FAT表的前2个表项规定不使用

- FAT表中的先后关系
    - 以簇（扇区）为单位存储文件魏居
    - 每个表项 (vec[i]) 表示文件謝居的实际位置（簇）
        - DIR_FstClus 表示文件第0簇（扇区）的位置
        - vec[DIR_FstClus] 表示文件第1簇（扇区）的位置
        - vec[vec[DIR_FstClus]] 表示文件第2簇（扇区）的位置
        - ......

- FAT12数据物理组织示意
    ![](_v_images_005/3.png)

- FAT12数据逻辑组织示意
    ![](_v_images_005/4.png)


- 实验 ：加载 FAT12 中的文件数据
    - 步骤：
        - 在根目录区查找目标文件对应的项
        - 获取目标文件的起始簇号和文件大小
        - 根据FAT表中记录的遐$胃先后关系读取數据

- 小贴士一
    - FAT表中的每个表项只占用12比特（1.5字节）
    - FAT表一共记录了 BPB_BytsPerSec * 9 * 2 / 3 个表项
    - 可 以 使 用 4 short表 表 项 的 值
    - 如果表项值大于等于OxFFS ,则说明已经到达最后一个簇
    - 如果表项值等于0xFF7 ,则说明当前簇已经损坏

- 小贴士二
    - 数据区起始簇（扇区）号为33 , 地址为 0x4200
    - 数据区起始地址所对应的编号为2 ( 不为0 )
    - 因此，DIR FstClus对应的地址为：
        - 0x4200 + (DIR_FstClus - 2) * 512

# 编程实验 读取指定文件内容

# 小结
- FAT12根目录区记录了文件的起始簇号和长度
- 通过查找根目录区能够确定是否存在目标文件
- FAT12文件数据的组织使用了单链表的思想
    - 文件数据罔散的分布于存賭介质中
    - 文件数据通过FAT项进行关联

