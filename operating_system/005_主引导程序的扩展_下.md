主引导程序的扩展

■问题

                      如何在FAT12根目录中查找是否
                                存在目标文件？

狄泰一+未来                  ◎ 2018成都狄泰未来科技有限公司                                       唐佐林视^频教程

主引导程序的扩展

■根目录区的大小和位置

            大小：       BPB_RootEntCnt * sizeof(RootEntry)
                                BPB_BytsPerSec

位置：         扇区位置        长度                                        内容
                 0            1 (512 B)                           引导程序
                 1           9 (4608 B)                           FAT 表 1
                10           9 (4608 B)                           FAT 表 2
                19           14(7168 B)                           目录文件项
                33                                                文麵居
                                                            ————

狄泰一+未来                  ◎ 2018成都狄泰未来科技有限公司                                       1唐佐林娜教程

            封W的扩展

■ FAT12文件系统中的根目录区

            根目录区由目录项构成，每一个目录项
               代表根目录中的一T文件索引。

            数据成员        偏移 长度                                     描述

            DIR 一 Name  0x00 OxOB                                 文件名8字节，扩展名3字节
                                                                  文件属性
            DIR_Attr    OxOB 0x01                                 保留位
                                                                  最后一次写入时间
            Reserve     OxOC OxOA                                 最后 一次写入日期
                                                                  文件开始的簇号
32 Bytes H  DIR 一WrtTime 0x16 0x02                                文件大小

            DIR_WrtDate 0x18 0x02

            DIR_FstClus 0x1A 0x02

            DIR FileSize 0x1 C 0x04

狄泰一+未来                  © 2018成都狄泰未来科技有限公司                                       唐佐林彳见顷教程

主引导程序的扩展

■ 实 验 ： i卖取FAT12文件系统的根目录信息
    -步骤：
          ♦创建RootEntry结构体类型
          ♦ 使用文件流顺序读取每个项的内容
          ♦ 解析并打印相关的信息

狄泰一+未来                  © 2018成都狄泰未来科技有限公司                                       唐佐林视^频教程

The shortest answer is doing.

                        编程实验

                        读取根目录信息

狄泰一+未来                  ◎ 2018成都狄泰未来科技有限公司                                       唐佐林视^频教程

主引导程序的扩展

■目录项的中的关键成员
    - DIR Name

           •文件名（用于判断是否为目标文件)

    -DIR_FstClus

           •文體据起始存储位置（甩于确定读取位置)

    -DIR_FileSize

           •文件大小（用于确定读取的字节數）

狄泰一+未来                  ◎ 2018成都狄泰未来科技有限公司                                       唐佐林娜教程

主引导程序的扩展

■ FAT表-FAT12的数据组织核心
    -FAT1和FAT2是相互备份的关系，数据内容完全一致
    -FAT表^^关系图，记录了文件数据的先后关系
    -每呼FAT表项暂用12比特
    -FAT表的前2个表项规定不使用

---------------------------------我是可爱的页面分割线-------------------------------------
狄泰令+未来          © 2018成都狄泰未来科技有限公司                                                 唐佐林娜教程

主引导程序的扩展

■ FAT表中的先后关系

     一以薛（扇区）为单位存储文件魏居

    -每个表项（vec[i])表示文件謝居的实际位置（簇）

           • DIR_FstClus表示文件第0簇（扇区）的位置
           • vec[DIR_FstClus]表示文件第1簇（扇区）的位置
           • vec[vec[DIR_FstClus]]表示文件第2簇（扇区）的位置

狄泰令+未来          © 2018成都狄泰未来科技有限公司                                                 唐佐林视频教程

主引导程序的扩展

■ FAT12数据物理组织示意

             □ □ 回 □ □□                               □ □□                □
                                                                田         □
             □□ □                      □                               □0□□
                                                回     口□
                                                      E    □                    S
存            □
储                                      □□                 _Q
                                       □□
单
             DIR FstClus = addr C
兀

            数据区
                                    C

牙j

                                          0

                                                   z

主引导程序的扩展

■ FAT12数据逻辑组织示意

DIR FstClus

狄泰令+未来          © 2018成都狄泰未来科技有限公司                                                          NULL
                                                                                   唐佐林娜教程

主引导程序的扩展

■ 实 验 ： 加 载 FAT12中的文件数据
        步骤：

               在根目录区查找目标文件对应的项
               获取目标文件的起始簇号和文件大小
               根据FAT表中记录的遐$胃先后关系读取數据

狄泰令+未来          ◎ 2018成都狄泰未来科技有限公司                                                 唐佐林视频教程

主引导程序的扩展

小贴士 一

     FAT表中的每个表项只占用12比特（1.5字节）
 一 FAT表一共记录了 BPB_BytsPerSec * 9 * 2 / 3 个表项

 - 可 以 使 用 4 short表 表 项 的 值

     如果表项值大于等于OxFFS ,则说明已经到达最后一个簇
     如果表项值等于0xFF7 ,则说明当前簇已经损坏

狄泰令+未来          ◎ 2018成都狄泰未来科技有限公司                                                 唐佐林丨见须教程

主引导程序的扩展

小贴士.
    数据区起始簇（扇区）号为33 , 地 址 为 0 x4200
    数据区起始地址所对应的编号为2 ( 不 为 0 )

 - 因 此 ，DIR FstClus对应的地址为：
        0x4200 + (DIR_FstClus - 2) * 512

狄泰一一未来          ◎ 2018成都狄泰未来科技有限公司                                                 唐佐林视^频教程

The shortest answer is doing

                                       编程实验

                                       读取指定文件内容

---------------------------------我是可爱的页面分割线-------------------------------------
狄泰夺+未来  ◎ 2018成都狄泰未来科技有限公司

 小结

■ FAT12根目录区记录了文件的起始簇号和长度
■通过查找根目录区能够确定是否存在目标文件
■ FAT12文件数据的组织使用了单链表的思想

    -文件数据罔散的分布于存賭介质中
    -文件数据通过FAT项进行关联

  狄泰未来

在这里收获的是未来，而不只是技术!
             交流群：199546072

                  ◎ 2018成都狄泰未来科技有限公司

---------------------------------我是可爱的页面分割线-------------------------------------
